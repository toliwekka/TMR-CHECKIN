<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TMR International | T-Check Portal</title>
  <link rel="icon" type="image/png" href="./logo.png" />
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet" />
        <!-- Font Awesome -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
        <link rel="stylesheet" href="themes.css" />
        <link rel="stylesheet" href="chkstyles.css" />

        <style>
            /* General Styling */
            body {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                overflow-x: hidden; /* Prevent horizontal scrolling */
            }

            /* Survey Container Styling */
            .survey-container {
                padding: 1.5rem;
                margin-top: 40px; /* Add margin to ensure the top of the page is visible */
            }

            /* Responsive Design */
            @media (max-width: 768px) {
                .survey-container {
                    padding: 1.5rem;
                    margin-top: 40px; /* Ensure the top of the page is visible by adding more space */
                }
            }

            @media (max-width: 480px) {
                .survey-container {
                    padding: 1rem;
                    margin-top: 40px; /* Ensure the top of the page is visible */
                }

                .flip-badge {
                    font-size: 1.2rem;
                    width: 30px;
                    height: 30px;
                    line-height: 30px;
                }
            }
        </style>



        <style>
            /* General Styling */
            body {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                overflow-x: hidden; /* Prevent horizontal scrolling */
                font-family: 'Poppins', sans-serif;
            }

            /* Survey Container Styling */
            .survey-container {
                padding: 1.5rem;
                margin-top: 40px;
                width: 100%;
                box-sizing: border-box;
            }

            /* Responsive Design */
            @media (max-width: 768px) {
                .survey-container {
                    padding: 1rem;
                    margin-top: 30px;
                }

                .flip-badge {
                    font-size: 1.5rem;
                }
            }

            @media (max-width: 480px) {
                .survey-container {
                    padding: 1rem;
                    margin-top: 20px;
                }

                .flip-badge {
                    font-size: 1.2rem;
                    width: 30px;
                    height: 30px;
                    line-height: 30px;
                }
            }

            /* Ensure buttons are flexible */
            .continue-button {
                width: 100%;
                padding: 1rem;
                font-size: 1.1rem;
                border: none;
                cursor: pointer;
                margin-top: 1rem;
            }

            /* Make the theme switcher mobile-friendly */
            .theme-switcher select {
                width: 100%;
                padding: 0.8rem;
                font-size: 1rem;
            }

            /* Flip badge */
            .flip-badge {
                font-size: 2rem;
                background: #007bff;
                color: white;
                border-radius: 50%;
                display: inline-block;
                width: 50px;
                height: 50px;
                text-align: center;
                line-height: 50px;
            }

            /* Survey Card */
            .survey-card {
                margin-bottom: 2rem;
            }

            .survey-card h3 {
                font-size: 1.3rem;
            }

            /* Responsive Buttons */
            .chk-accordion {
                width: 100%;
                text-align: center;
                background: #27ef96;
                padding: 1.5rem;
                cursor: pointer;
                border-radius: 14px;
                margin-top: 1rem;
                box-shadow: 0 8px 16px rgba(155, 89, 182, 0.15);
                transition: background-color 0.3s ease;
            }

            .chk-accordion:hover {
                background-color: #d6fff1;
            }

            .chk-accordion .chk-icon {
                font-size: 2.2rem;
                color: #7a478d;
                margin-bottom: 0.75rem;
            }

            .chk-accordion .chk-title {
                font-size: 1.3rem;
                font-weight: 600;
                color: #311d53;
            }

            .chk-accordion .chk-description {
                font-size: 0.95rem;
                color: #5d3d73;
            }

            /* Additional Styling for Mobile View */
            .chk-accordion.serene-theme {
                padding: 1rem;
            }





























/* Base container styling */
.survey-container {
    width: 100%;
    height: auto;
    padding: 20px;
    box-sizing: border-box;
    font-size: 1vw; /* Text size adjusts based on viewport width */
    border-radius: 8px;
    margin: 0 auto;
    transition: all 0.3s ease;
}

/* Responsive adjustments for smaller screens */
@media (max-width: 1200px) {
    .survey-container {
        font-size: 2.5vw; /* Adjust text size slightly larger for larger screens */
    }
}

@media (max-width: 768px) {
    .survey-container {
        font-size: 3vw; /* Adjust text size slightly larger for medium screens */
        padding: 15px; /* Adjust padding for smaller screens */
    }
}

@media (max-width: 480px) {
    .survey-container {
        font-size: 4vw; /* Increase text size for mobile */
        padding: 10px; /* Reduce padding */
    }
}

/* Optional: Make sure text size doesn't become too small or large */
.survey-container h1,
.survey-container p {
    font-size: calc(1rem + 2vw); /* Uses both rem and vw for flexible font size */
}

/* Optional: Add a scrollable container */
.survey-container {
    max-height: 90vh; /* Limits height to 90% of the viewport height */
    overflow-y: auto; /* Adds scrolling if content exceeds the max height */
}











/* Base container styling */
.survey-container {
    width: 100%;
    height: auto;
    padding: 20px;
    box-sizing: border-box;
    font-size: 1rem; /* Set a solid base font size */
    line-height: 1.6;
    border-radius: 8px;
    margin: 0 auto;
    max-height: 90vh;
    overflow-y: auto;
    transition: all 0.3s ease;
}

/* Headers and paragraph scaling smoothly */
.survey-container h1 {
    font-size: clamp(1.5rem, 2vw + 1rem, 2.75rem); /* Responsive between 1.5rem and 2.75rem */
}

.survey-container p {
    font-size: clamp(1rem, 1.25vw + 0.5rem, 1.25rem); /* Responsive but controlled */
}

/* Responsive tweaks */
@media (max-width: 768px) {
    .survey-container {
        padding: 16px;
    }
}

@media (max-width: 480px) {
    .survey-container {
        padding: 12px;
    }
}


#chkpt.survey-container {
  overflow-y: scroll;     /* Always show vertical scrollbar */
  overflow-x: scroll;     /* Always show horizontal scrollbar */
  box-sizing: border-box;
  padding: 1rem;
  margin: 0 auto;
  transition: none !important;
}


/* Webkit (Chrome, Safari) */
#chkpt.survey-container::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

#chkpt.survey-container::-webkit-scrollbar-thumb {
  background-color: rgba(0, 0, 0, 0.3);
  border-radius: 4px;
}

#chkpt.survey-container::-webkit-scrollbar-track {
  background: transparent;
}


html, body {
  margin: 0;
  padding: 0;
  height: auto;
  min-height: 100vh;
  overflow-y: auto; /* Allow scrolling */
}




html,
body {
    margin: 0;
    padding: 0;
    min-height: 100vh;
    overflow-y: auto;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Page wrapper for additional structure if needed */
.page-wrapper {
    width: 100%;
    padding: 1rem;
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Main survey container */
#chkpt.survey-container {
    width: 800px;
    max-width: 100%;
    height: auto;
    max-height: 90vh; /* Keeps it from overflowing vertically */
    overflow: auto;
    box-sizing: border-box;
    padding: 1rem;
    margin: 0 auto;

    /* Disable all transitions */
    transition: none !important;
    animation: none !important;
    transform: none !important;
}

/* Optional scrollbars */
#chkpt.survey-container::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

#chkpt.survey-container::-webkit-scrollbar-thumb {
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
}

#chkpt.survey-container::-webkit-scrollbar-track {
    background: transparent;
}

/* Responsive tweaks (no layout change, just spacing adjustments) */
@media (max-width: 768px) {
    .survey-container {
        padding: 1rem;
    }
}

@media (max-width: 480px) {
    .survey-container {
        padding: 0.75rem;
    }
}






html,
body {
    margin: 0;
    padding: 0;
    min-height: 100vh;
    overflow-y: auto;
    display: block; /* important: do NOT use flex here */
}

/* Optional wrapper for structure (not centering vertically anymore) */
.page-wrapper {
    width: 100%;
    padding: 2rem 1rem;
    display: flex;
    justify-content: center;
    align-items: flex-start; /* top-aligned */
    box-sizing: border-box;
}

/* Main survey container */
#chkpt.survey-container {
    width: 800px;
    max-width: 100%;
    height: auto;
    overflow: auto;
    box-sizing: border-box;
    padding: 1.5rem;
    margin: 0 auto;

    /* Disable transitions */
    transition: none !important;
    animation: none !important;
    transform: none !important;
}

/* Custom scrollbars */
#chkpt.survey-container::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

#chkpt.survey-container::-webkit-scrollbar-thumb {
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
}

#chkpt.survey-container::-webkit-scrollbar-track {
    background: transparent;
}

/* Responsive tweaks */
@media (max-width: 768px) {
    .survey-container {
        padding: 1rem;
    }
}

@media (max-width: 480px) {
    .survey-container {
        padding: 0.75rem;
    }
}



        </style>



    </head>
    <body>
        <!-- Main content area -->
        <div class="page-wrapper">
       
            <!-- Theme switcher -->
            <div class="theme-switcher">
                <select id="themeSelect" class="form-select">
                    <option value="default" selected> <img src="ogo.png" alt="TMR Fresh Logo" style="width: 20px; vertical-align: middle; margin-right: 8px; display: inline-block;" /> TMR </option>
                    <option value="fieryRed">ðŸ”¥ Fiery Red</option>
                    <option value="blushRose">ðŸŒ¸ Blush Rose</option>
                    <option value="midnightDark">ðŸŒš Midnight Dark</option>
                    <option value="sereneLavender">ðŸ’œ Serene Lavender</option>
                    <option value="oceanBreeze">ðŸŒŠ Ocean Breeze</option>
                    <option value="goldenSunset">ðŸŒ… Golden Sunset</option>
                    <option value="softStone">ðŸª¶ Soft Stone</option>
                    <option value="softBlush">ðŸ’– Soft Blush</option>
                </select>
            </div>

        <div id="chkpt" class="survey-container">
            <h1 class="text-center mb-4" style="color: var(--primary); font-weight: 700;">
                Begin Your T|Check Self-Discovery Journey
            </h1>

            <div class="flip-badge" id="questionBadge">1</div>

            <div class="survey-card">
                <h3 class="question-intro" id="questionSection">Section A</h3>
                <p class="question-context" id="questionMeta">During the past 14 days</p>
                <p class="question-text" id="questionText">Iâ€™ve been feeling optimistic about the future.</p>
            </div>

            <div class="option-card" id="optionsContainer">
                <!-- Options injected -->
            </div>
            <button id="continueBtn" class="continue-button" style="display: none;">
                Continue
            </button>

            <!-- Serene Lavender Consent Button -->
            <button id="chk-header" class="chk-accordion serene-theme" type="button" style="display: none;">
                <div class="chk-icon">
                    <i class="bi bi-bar-chart-line"></i>
                </div>
                <div class="chk-content">
                    <h3 class="chk-title">Step 3: Your Personal Insights</h3>
                    <p class="chk-description"></p>
                </div>
            </button>

            <style>
                .chk-accordion.serene-theme {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    width: 100%;
                    text-align: center;
                    background: #27ef96;
                    border: none;
                    border-radius: 14px;
                    padding: 1.5rem 1rem;
                    cursor: pointer;
                    margin-top: 10px;
                    transition: background-color 0.3s ease, opacity 0.3s ease;
                    box-shadow: 0 8px 16px rgba(155, 89, 182, 0.15);
                    font-family: "Poppins", sans-serif;
                }

                .chk-accordion.serene-theme:hover:not(:disabled) {
                    background-color: #d6fff1;
                }

                .chk-accordion:disabled {
                    opacity: 0.5;
                    cursor: not-allowed;
                    pointer-events: none;
                }

                .chk-icon {
                    font-size: 2.2rem;
                    color: var(--primary-dark, #7a478d);
                    margin-bottom: 0.75rem;
                }

                .chk-title {
                    font-size: 1.3rem;
                    font-weight: 600;
                    margin: 0.25rem 0;
                    color: var(--text-color, #311d53);
                }

                .chk-description {
                    font-size: 0.95rem;
                    color: #5d3d73;
                    margin: 0.25rem 0 0.5rem;
                }

                .consent-label {
                    font-size: 0.85rem;
                    font-weight: 500;
                    background: #d6fff1;
                    color: #fff;
                    padding: 0.4rem 0.8rem;
                    border-radius: 6px;
                    display: inline-block;
                    margin-top: 0.3rem;
                }
            </style>
        </div>
        </div>




        <script src="themes.js"></script>

        <!-- SCRIPT -->
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const btn = document.getElementById("chk-header");

                btn.addEventListener("click", () => {
                    // Redirect the full page to report.html
                    window.location.href = "staffreport.html";
                });
            });

            const questions = [
                {
                    id: 1,
                    section: "Life Satisfaction and Life Evaluation",
                    pastcoupledays: "",
                    text:
                        "Please imagine a ladder with steps numbered from zero at the bottom to ten at the top. The top of the ladder represents the best possible life for you, and the bottom of the ladder represents the worst possible life for you. On which step of the ladder would you say you personally feel you stand at this time?",
                    answerType: "Worst-Best",
                },
                { id: 2, section: "Life Satisfaction and Life Evaluation", pastcoupledays: "", text: "On which step do you think you will stand about five years from now?", answerType: "Worst-Best" },
                { id: 3, section: "Life Satisfaction and Life Evaluation", pastcoupledays: "", text: "Overall, how satisfied are you with life as a whole these days?", answerType: "Satisfaction" },
                { id: 4, section: "Physical Health, Mental Health, and Physical Function", pastcoupledays: "", text: "In general, how would you rate your physical health?", answerType: "Health" },
                { id: 5, section: "Physical Health, Mental Health, and Physical Function", pastcoupledays: "", text: "How would you rate your overall mental health?", answerType: "Health" },
                {
                    id: 6,
                    section: "Physical Health, Mental Health, and Physical Function",
                    pastcoupledays: "",
                    text: "For at least the past 6 months, to what extent have you been limited because of a health problem in activities people usually do?",
                    answerType: "Limitation",
                },
                { id: 7, section: "Meaning and Purpose", pastcoupledays: "", text: "Overall, to what extent do you feel the things you do in your life are worthwhile?", answerType: "Worthwhile" },
                { id: 8, section: "Meaning and Purpose", pastcoupledays: "", text: "I understand my purpose in life.", answerType: "Agreement" },
                { id: 9, section: "Meaning and Purpose", pastcoupledays: "", text: "I have a sense of direction and purpose in life.", answerType: "Agreement" },
                { id: 10, section: "Character and Caring", pastcoupledays: "", text: "I always act to promote good in all circumstances, even in difficult and challenging situations.", answerType: "TrueOfMe" },
                { id: 11, section: "Character and Caring", pastcoupledays: "", text: "Iâ€™m always able to give up some happiness now for greater happiness later.", answerType: "TrueOfMe" },
                { id: 12, section: "Character and Caring", pastcoupledays: "", text: "How often do you show someone in your community that you love or care for them?", answerType: "FrequencyNeg" },
                { id: 13, section: "Relationships", pastcoupledays: "", text: "I am content with my friendships and relationships.", answerType: "Agreement" },
                { id: 14, section: "Relationships", pastcoupledays: "", text: "My relationships are as satisfying as I would want them to be.", answerType: "Agreement" },
                { id: 15, section: "Relationships", pastcoupledays: "", text: "How often do you feel lonely?", answerType: "Loneliness" },
                { id: 16, section: "Community and Social Support", pastcoupledays: "", text: "How would you describe your sense of belonging to your local community?", answerType: "Community" },
                { id: 17, section: "Community and Social Support", pastcoupledays: "", text: "If you were in trouble, do you have relatives or friends you can count on to help you whenever you need them, or not?", answerType: "FrequencyNeg" },
                { id: 18, section: "Community and Social Support", pastcoupledays: "", text: "Are you satisfied or dissatisfied with the city or area where you live?", answerType: "Satisfaction" },
                { id: 19, section: "Financial Evaluation and Stability", pastcoupledays: "", text: "How often do you worry about being able to meet normal monthly living expenses?", answerType: "WorryAboutLivingExpenses" },
                { id: 20, section: "Financial Evaluation and Stability", pastcoupledays: "", text: "How often do you worry about safety, food, or housing?", answerType: "WorrySafety" },
                {
                    id: 21,
                    section: "Financial Evaluation and Stability",
                    pastcoupledays: "",
                    text:
                        "Please imagine the top of the ladder represents the best possible financial situation for you, and the bottom of the ladder represents the worst possible financial situation for you. Please indicate where on the ladder you stand right now.",
                    answerType: "Worst-Best",
                },
                { id: 22, section: "Affect", pastcoupledays: "", text: "In general, how happy or unhappy do you usually feel?", answerType: "Happiness" },
                { id: 23, section: "Affect", pastcoupledays: "", text: "During the past two weeks, how often have you experienced positive emotions such as joy, affection, or hope?", answerType: "FrequencyPos" },
                { id: 24, section: "Affect", pastcoupledays: "", text: "During the past two weeks, how often have you experienced negative emotions such as sadness, worry, or despair?", answerType: "FrequencyNeg" },
            ];

            const answerSetsII = {
                MentalWellBeing: ["None of the time", "Rarely", "Some of the time", "Often", "All of the time"],
                Satisfaction: ["Very dissatisfied", "Dissatisfied", "Neutral", "Satisfied", "Very satisfied"],
            };

            const answerSets = {
                "Worst-Best": ["0 = Worst Possible", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Best Possible"],
                Satisfaction: ["0 = Not Satisfied at All", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Completely Satisfied"],
                Health: ["0 = Poor", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Perfect Health"],
                Limitation: ["0 = Severely Limited", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Not Limited at All"],
                Worthwhile: ["0 = Not at All Worthwhile", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Completely Worthwhile"],
                Agreement: ["0 = Strongly Disagree", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Strongly Agree"],
                TrueOfMe: ["0 = Not True of Me", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Completely True of Me"],
                FrequencyNeg: ["0 = Never", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = All of the Time"],
                FrequencyPos: ["0 = All of the Time", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Never"],
                Happiness: ["0 = Extremely Unhappy", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Extremely Happy"],
                MentalWellBeing: ["0 = Not at All", "Rarely", "Some of the Time", "Often", "All the Time"],
                Community: ["0 = Very Weak", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Extremely Strong"],
                Loneliness: ["0 = Always", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Never"],
                SatisfactionWithCity: ["0 = Completely Dissatisfied", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Completely Satisfied"],
                WorrySafety: ["0 = Worry All of the Time", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Do Not Ever Worry"],
                WorryAboutLivingExpenses: ["0 = Worry All of the Time", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10 = Do Not Ever Worry"],
            };

            let currentIndex = 0;

            function applyTheme(themeName) {
                const theme = themes[themeName];
                Object.entries(theme).forEach(([key, val]) => {
                    document.documentElement.style.setProperty(key, val);
                });
                localStorage.setItem("theme", themeName);
            }

            let scoreTotal = 0;
            const userResponses = {}; // Stores numeric score per question
            const userAnswers = {}; // Stores question and answer text

            function renderQuestion(index) {
                const q = questions[index];
                document.getElementById("questionSection").textContent = q.section;
                document.getElementById("questionMeta").textContent = q.pastcoupledays;
                document.getElementById("questionText").textContent = q.text;
                document.getElementById("questionBadge").textContent = index + 1;

                const optionsContainer = document.getElementById("optionsContainer");
                optionsContainer.innerHTML = "";

                (answerSets[q.answerType] || []).forEach((opt) => {
                    const btn = document.createElement("button");
                    btn.className = "option";
                    btn.textContent = opt;

                    if (opt.length > 6) btn.classList.add("long-option");

                    btn.addEventListener("click", () => {
                        // Clear previous selection visuals
                        const allButtons = optionsContainer.querySelectorAll(".option");
                        allButtons.forEach((b) => b.classList.remove("selected"));
                        btn.classList.add("selected");

                        // Extract score
                        let score = 0;
                        const match = opt.match(/^(\d+)\s*=?/); // e.g., "3 = Sometimes"
                        if (match) {
                            score = parseInt(match[1]);
                        } else if (!isNaN(opt)) {
                            score = parseInt(opt);
                        }

                        // Adjust total if user changed answer
                        if (userResponses[index] !== undefined) {
                            scoreTotal -= userResponses[index];
                        }
                        userResponses[index] = score;
                        scoreTotal += score;

                        // Save question and selected answer
                        userAnswers[index] = {
                            question: q.text,
                            answer: opt,
                        };

                        // Save to localStorage
                        localStorage.setItem("form_064_PartB_Score", scoreTotal);
                        localStorage.setItem("form_065_PartB_Answers", JSON.stringify(userAnswers));


                        // Continue or disable on final question
                        setTimeout(() => {
                            if (index === questions.length - 1) {
                                document.getElementById("chk-header").style.display = "block";
                                console.log("âœ… Final Score:", scoreTotal);

                                // âŒ Disable all buttons after last question is answered
                                const allButtons = optionsContainer.querySelectorAll(".option");
                                allButtons.forEach((b) => {
                                    b.disabled = true;
                                    b.classList.add("disabled"); // Optional: add class for styling
                                });
                            } else {
                                currentIndex++;
                                renderQuestion(currentIndex);
                            }
                        }, 200);
                    });

                    optionsContainer.appendChild(btn);
                });
            }

            // Initialize and apply theme as early as possible
            let currentTheme = localStorage.getItem("theme") || "default";
            applyTheme(currentTheme);

            // Theme selection dropdown
            document.addEventListener("DOMContentLoaded", () => {
                const themeSelect = document.getElementById("themeSelect");
                if (themeSelect) {
                    themeSelect.value = currentTheme;
                    themeSelect.addEventListener("change", (e) => {
                        applyTheme(e.target.value);
                    });
                }

                // Render initial question
                renderQuestion(currentIndex);

                // Re-broadcast theme for late-loading iframes
                setTimeout(() => {
                    broadcastThemeToIframes(currentTheme);
                }, 500);
            });

            // Apply the selected theme
            function applyTheme(themeName) {
                const theme = themes[themeName];
                if (!theme) return;

                // Apply CSS variables
                Object.entries(theme).forEach(([key, value]) => {
                    document.documentElement.style.setProperty(key, value);
                });

                // Adjust text color for readability
                setHeroDescriptionTextColor();

                // Persist and sync
                localStorage.setItem("theme", themeName);
                currentTheme = themeName;
                broadcastThemeToIframes(themeName);
            }

            // Send theme to all iframes
            function broadcastThemeToIframes(themeName) {
                document.querySelectorAll("iframe").forEach((iframe) => {
                    iframe.contentWindow?.postMessage({ theme: themeName }, "*");
                });
            }

            // Adjust text color based on theme background
            function setHeroDescriptionTextColor() {
                const bg = getComputedCSSVar("--primary-dark");
                if (!bg || !bg.startsWith("#")) return;
                const luminance = getLuminance(bg);
                const color = luminance > 0.5 ? "#111" : "#fff";
                const heroDesc = document.querySelector(".hero-description");
                if (heroDesc) heroDesc.style.color = color;
            }

            // Get CSS variable value
            function getComputedCSSVar(variable) {
                return getComputedStyle(document.documentElement).getPropertyValue(variable).trim();
            }

            // Calculate luminance for color contrast
            function getLuminance(hex) {
                const rgb = hex
                    .replace("#", "")
                    .match(/.{2}/g)
                    .map((x) => parseInt(x, 16) / 255);
                const lum = rgb.map((c) => (c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4)));
                return 0.2126 * lum[0] + 0.7152 * lum[1] + 0.0722 * lum[2];
            }

            // Listen for theme sync messages
            window.addEventListener("message", (event) => {
                if (event.data?.theme && themes[event.data.theme]) {
                    applyTheme(event.data.theme);
                    const themeSelect = document.getElementById("themeSelect");
                    if (themeSelect) themeSelect.value = event.data.theme;
                }
            });
        </script>
    </body>
</html>
