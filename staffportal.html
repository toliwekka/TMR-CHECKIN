<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>TMR International | T-Check Portal</title>
        <link rel="icon" type="image/png" href="./logo.png" />

        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
        <!-- FullCalendar -->
        <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet" />
        <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

        <!-- Toastify -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" />
        <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
        <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
        <style>
            :root {
                --mint-green: #006c9c; /* TMR Deep Blue replacing Mint Green */
                --light-gray: #e6f4f9; /* Light blue-tinted background */
                --dark-gray: #003d5b; /* Deep TMR Header/Text color */
                --text-color: #004c74; /* Mid-tone TMR Blue for regular text */
            }

            body {
                font-family: "Poppins", sans-serif;
            }

            /* Sidebar Styling */
            .sidebar {
                background-color: var(--mint-green);
                color: white;
                height: 100%;
                width: 250px;
                padding-top: 20px;
            }

            .sidebar-item:hover {
                background-color: rgba(46, 190, 142, 0.2);
                transition: background-color 0.3s ease;
            }

            .sidebar-icon {
                width: 20px;
                height: 20px;
                margin-right: 12px;
            }

            /* Card Styling */
            .card {
                background-color: white;
                border-radius: 15px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                padding: 24px;
                transition: box-shadow 0.3s ease;
            }

            .card:hover {
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            }

            /* Progress Circle */
            .progress-circle {
                background: conic-gradient(#34d399 0% 50%, #f87171 50% 100%);
                border-radius: 50%;
                width: 120px;
                height: 120px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 24px;
                color: #1f2937;
            }
        </style>

        <style>
            /* Full CSS (Styling, Glass, Animations) */
            h1 {
                text-align: center;
                margin-top: 20px;
                font-weight: 600;
                font-size: 28px;
            }
            #calendar {
                margin: 20px auto;
                max-width: 1100px;
                background: rgba(255, 255, 255, 0.6);
                backdrop-filter: blur(14px);
                border-radius: 20px;
                box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
                padding: 20px;
                animation: fadeIn 1s ease;
            }
            .fab {
                position: fixed;
                bottom: 30px;
                right: 30px;
                width: 60px;
                height: 60px;
                background: #34d399;
                border-radius: 50%;
                color: white;
                font-size: 32px;
                display: flex;
                justify-content: center;
                align-items: center;
                cursor: pointer;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
                z-index: 1000;
                transition: background 0.3s ease;
            }
            .fab:hover {
                background: #059669;
            }
            .modal {
                display: none;
                position: fixed;
                z-index: 2000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                overflow-y: auto;
                animation: fadeIn 0.5s ease;
            }
            .modal-content {
                background: #fff;
                margin: 50px auto;
                padding: 20px;
                width: 400px;
                border-radius: 16px;
                animation: slideDown 0.5s ease;
            }
            .modal-content input,
            .modal-content textarea,
            .modal-content select {
                width: 100%;
                margin-bottom: 12px;
                padding: 10px;
                border-radius: 8px;
                border: 1px solid #ccc;
                font-size: 14px;
            }
            button {
                background: #34d399;
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 10px;
                cursor: pointer;
                font-weight: bold;
                margin-top: 10px;
                width: 100%;
            }
            button:hover {
                background: #059669;
            }
            #deleteTask {
                background: #f87171;
            }
            #deleteTask:hover {
                background: #dc2626;
            }
            @keyframes fadeIn {
                from {
                    opacity: 0;
                }
                to {
                    opacity: 1;
                }
            }
            @keyframes slideDown {
                from {
                    transform: translateY(-50px);
                    opacity: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }
        </style>
    </head>
    <body class="bg-light-gray font-sans">
        <div class="flex">
            <!-- Sidebar -->
            <aside class="sidebar p-6">
                <div class="mb-8">
                    <h1 class="text-2xl font-bold text-white">TMR Staff</h1>
                </div>
                <nav>
                    <ul>
                        <li class="sidebar-item flex items-center py-3">
                            <span class="sidebar-icon">üìù</span>
                            <a href="assessmentintroa.html" class="text-lg text-white">Start Your Check-In</a>
                        </li>
                        <li class="sidebar-item flex items-center py-3">
                            <span class="sidebar-icon">üìä</span>
                            <a href="#" class="text-lg text-white">System Overview</a>
                        </li>
                        <li class="sidebar-item flex items-center py-3 opacity-20 cursor-not-allowed">
                            <span class="sidebar-icon">‚ö†Ô∏è</span>
                            <a href="#" class="text-lg text-white">Risk Monitor</a>
                        </li>
                        <li class="sidebar-item flex items-center py-3 opacity-20 cursor-not-allowed">
                            <span class="sidebar-icon">üîó</span>
                            <a href="#" class="text-lg text-white">System Integrations</a>
                        </li>
                        <li class="sidebar-item flex items-center py-3 opacity-20 cursor-not-allowed">
                            <span class="sidebar-icon">üìù</span>
                            <span class="text-lg text-white">Health Reports</span>
                            <ul class="pl-6 mt-2">
                                <li><a href="#" class="text-white">Environment Pulse</a></li>
                                <li><a href="#" class="text-white">Cognitive Load</a></li>
                                <li><a href="#" class="text-white">Life-Work Balance</a></li>
                                <li><a href="#" class="text-white">Resilience Gauge</a></li>
                                <li><a href="#" class="text-white">Stress Level</a></li>
                            </ul>
                        </li>
                    </ul>
                </nav>
                <div class="mt-6">
                    <h2 class="text-sm font-semibold text-white">Support Hub</h2>
                    <ul class="mt-4">
                        <li class="sidebar-item flex items-center py-3 opacity-20 cursor-not-allowed">
                            <span class="sidebar-icon">üì±</span>
                            <a href="#" class="text-white">App Support</a>
                        </li>
                        <li class="sidebar-item flex items-center py-3">
                            <span class="sidebar-icon">üìà</span>
                            <a href="#" class="text-white">Data Insights</a>
                        </li>
                        <li class="sidebar-item flex items-center py-3">
                            <span class="sidebar-icon">üìÖ</span>
                            <a href="#" class="text-white">Well-being Scheduler</a>
                        </li>
                        <li class="sidebar-item flex items-center py-3 opacity-20 cursor-not-allowed">
                            <span class="sidebar-icon">üíº</span>
                            <a href="#" class="text-white">Service Offerings</a>
                        </li>
                    </ul>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="flex-1 p-8">
                <header class="flex justify-between items-center mb-8">
                    <h2 class="text-2xl font-bold text-#8f4141">TMR Staff Dashboard</h2>
                    <div class="flex space-x-4"></div>
                </header>

                <!-- Health Score Section -->
                <section class="card mb-6">
                    <h3 class="text-lg font-semibold text-#8f4141"><span id="userName"></span>, your journey so far has led to these results. Let‚Äôs see what they reveal!</h3>

                    <div class="mt-4 flex justify-center items-center">
                        <section class="card mb-6">
                            <h2>üß† Mental Well-Being Snapshot</h2>
                            <p><strong>Raw Score:</strong> <span id="partA-raw">--</span> / 70</p>
                            <p><strong>Percentage:</strong> <span id="partA-percent">--</span></p>
                            <p><strong>Status:</strong> <span id="partA-status">--</span></p>
                            <em id="partA-comment">Awaiting analysis...</em>
                        </section>
                        <section class="card mb-6">
                            <h2>üéØ Behavioral Evaluation</h2>
                            <p><strong>Raw Score:</strong> <span id="partB-raw">--</span> / 240</p>
                            <p><strong>Percentage:</strong> <span id="partB-percent">--</span></p>
                            <p><strong>Status:</strong> <span id="partB-status">--</span></p>
                            <em id="partB-comment">Awaiting data...</em>
                        </section>
                    </div>
                    <div class="mt-4 flex justify-center items-center">
                        <div class="chart-area">
                            <div id="gaugeA"></div>
                        </div>
                        <div class="chart-area">
                            <div id="gaugeB"></div>
                        </div>
                    </div>
                </section>

                <!-- Appointment Incoming -->
                <section class="card mb-6">
                    <h3 class="text-lg font-semibold text-#8f4141">Appointment Incoming, It‚Äôs On the Calendar</h3>
                    <ul class="mt-4 text-sm text-gray-500">
                        <div id="calendar" style="width: 100vw; height: 50vh; margin: 40px auto; overflow: hidden;"></div>
                        <!-- Modal -->

                        <div id="taskModal" class="modal">
                            <div class="modal-content">
                                <h3>Add / Edit Task</h3>
                                <input type="text" id="taskTitle" placeholder="Task Title" />
                                <textarea id="taskDescription" placeholder="Description"></textarea>
                                <select id="taskIcon">
                                    <option value="">Choose Icon</option>
                                    <option>üßò Meditation</option>
                                    <option>üé® Art Therapy</option>
                                    <option>üìù Journaling</option>
                                    <option>üéß Music Relaxation</option>
                                    <option>üö∂ Mindful Walk</option>
                                    <option>üìö Reading Therapy</option>
                                    <option>üí¨ Talk Therapy</option>
                                    <option>üè• T|Check-Point</option>
                                    <option>üìÜ Book Session</option>
                                </select>
                                <select id="taskMood">
                                    <option value="">Mood</option>
                                    <option>Happy</option>
                                    <option>Calm</option>
                                    <option>Motivated</option>
                                    <option>Stressed</option>
                                    <option>Sad</option>
                                </select>
                                <select id="taskPriority">
                                    <option value="">Priority</option>
                                    <option>High</option>
                                    <option>Medium</option>
                                    <option>Low</option>
                                </select>
                                <input type="date" id="taskDate" />
                                <input type="time" id="taskStartTime" />
                                <input type="time" id="taskEndTime" />
                                <button id="saveTask">Save Task</button>
                                <button id="deleteTask">Delete Task</button>
                                <button onclick="closeModal()">Cancel</button>
                            </div>
                        </div>
                    </ul>
                    <button class="mt-4 bg-mint-green text-white px-4 py-2 rounded shadow">Download Results</button>
                </section>
            </main>
        </div>

        <!-- ‚úÖ Firebase + Firestore Setup and Data Fetch -->
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
            import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

            const firebaseConfig = {
                apiKey: "AIzaSyDeDsOiA6QP4qbedd_JmQ9na1hM3sf4y3Q",
                authDomain: "mentalhealthtracker-15563.firebaseapp.com",
                projectId: "mentalhealthtracker-15563",
            };

            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);

            let progressChartInstance = null;

            const first = localStorage.getItem("form_005_first-name")?.trim();
            const last = localStorage.getItem("form_006_surname")?.trim();
            const email = localStorage.getItem("form_007_email")?.trim()?.toLowerCase();

            if (!first || !last || !email) {
                alert("Missing user information in localStorage.");
            } else {
                const q = query(collection(db, "tmrstaffResponses"), where("form_005_first-name", "==", first), where("form_006_surname", "==", last), where("form_007_email", "==", email));

                getDocs(q)
                    .then((snapshot) => {
                        if (snapshot.empty) {
                            alert("No assessments found for these details.");
                            return;
                        }

                        const partA = [];
                        const partB = [];
                        const events = [];

                        snapshot.forEach((doc) => {
                            const data = doc.data();
                            const scoreA = parseFloat(data.form_062_PartA_Score);
                            const scoreB = parseFloat(data.form_064_PartB_Score);

                            if (!isNaN(scoreA)) partA.push(scoreA);
                            if (!isNaN(scoreB)) partB.push(scoreB);

                            if (data.form_000_evaluationDate) {
                                const firstName = data["form_005_first-name"]?.trim() || "";
                                const lastName = data["form_006_surname"]?.trim() || "";
                                const fullName = `${firstName} ${lastName}`.trim() || "Assessment Taken";

                                const userNameElement = document.getElementById("userName");
                                if (userNameElement) userNameElement.textContent = fullName;

                                localStorage.setItem("lastFullName", fullName);

                                events.push({
                                    title: "üìù Assessment",
                                    start: data.form_000_evaluationDate,
                                    extendedProps: {
                                        scoreA: !isNaN(scoreA) ? scoreA : null,
                                        scoreB: !isNaN(scoreB) ? scoreB : null,
                                        fullName: fullName,
                                    },
                                });
                            }
                        });

                        if (window.Chart) {
                        }
                    })
                    .catch((err) => {
                        console.error("Error fetching Firestore data:", err);
                    });
            }

            function average(arr1, arr2) {
                const all = [...arr1, ...arr2];
                if (!all.length) return 0;
                return all.reduce((a, b) => a + b, 0) / all.length;
            }
        </script>
          <script src="staffportal.js"></script>

    </body>
</html>
